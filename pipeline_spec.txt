
Processing Folder:
    /share/biocore/projects/Trimmer_James_UCD/Hybridoma-Seq-Processing/

RawData Folder:
    /share/biocore/projects/Trimmer_James_UCD/Hybridoma-Seq-Processing/00-RawData


Folder Structure:
    00-RawData - contains a copy of all plates that need to be processed (as well as some testing data etc).
    01-Processing - contains an analysis folder for each processed plate 
    02-Reporting - contains across-runs analysis results and aggregated file file.
    ProcessAddGene - contains scripts for downloading and annotating AddGene sequences
    NeuroMabSeq - contains a clone of the NeuroMabSeq repo, with pipeline checkout.
    TrimmerConda - contains ANARCI and some Python modules as well as HTStream v1.3.3


Pipeline:
    SampleSheet.tsv is a 7 column Tab Separated Values file that defines the plates, primers used, and when sequencing was done (for reporting). Only plates in this sheet will be processed.
    Columns are:
        filePrefix - prefix for the fastq files - formatting varies depending on DNA Tech Core naming
        plate: consistent naming (TRIMMER00NN_PNN) for output plates and associated tables.
        submissionID: contains the ID the submission system uses, this should be 12 random digits
        Primers: contains the name of the primer definition to use for demultiplexing and trimming.
        SeqYear: Year plate was sequenced
        SeqMonth: Month plate was sequenced
        SeqDay: Day plate was sequenced

############ Running the pipeline #############

# Pre-Reqs:
1) COPY new data from /share/illumina/miseq/<run folder>/*.fastq.gz to 
    /share/biocore/projects/Trimmer_James_UCD/Hybridoma-Seq-Processing/00-RawData

2) Update the NeuroMabSeq/SampleSheet.txt to add the appropriate prefix, TRIMMER00NN_PNN, and submission system ID.
    Commit and push changes.
    cd /share/biocore/projects/Trimmer_James_UCD/Hybridoma-Seq-Processing/NeuroMabSeq
    git pull


# 0) Activate the Conda environment, R and gcc modules, and set RLib:
module load R/3.6.3
module load gcc/8.2.0
export R_LIBS_SITE=/share/biocore/projects/Trimmer_James_UCD/Hybridoma-Seq-Processing/Rlib.3.6.3
source TrimmerConda/bin/activate

# 1) Setup the pipeline, note that symlinks will fail for plates that have already been processed 
python3 NeuroMabSeq/setup_pipeline.py

    
# 2) Run cleaning, uncomment for all plates:
#bash run_All_HTS.sh
bash run_New_HTS.sh

# 3) Run processing:
parallel -j 10 < run_processing.sh


# 4) Aggregate samples and generate an across-plate report:
    module load R/3.6.3
    Rscript -e "rmarkdown::render('./02-Reporting/analyze_plates.rmd')"

# 5) Rsync combined results file to server:
