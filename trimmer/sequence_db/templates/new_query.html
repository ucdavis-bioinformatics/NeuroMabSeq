{% extends 'base.html' %}
{% load widget_tweaks %}
{% load static %}

{% block content %}

<style>
table {
    font-family: arial, sans-serif;
    border-collapse: collapse;
}

tr:nth-child(even) {
    background-color: #dddddd;
}
td {
    white-space: nowrap;
    align: left;
}

td.wrapok {
    white-space:normal
}

.sorting, .sorting_asc, .sorting_desc {
    background : none;
}
</style>

<!-- Datatables stuff -->
<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.17/css/jquery.dataTables.css">
<script src="https://code.jquery.com/jquery-1.9.1.js"></script>
<script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/1.10.17/js/jquery.dataTables.js"></script>

<script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/1.10.9/js/jquery.dataTables.min.js"></script>
<script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/responsive/1.0.7/js/dataTables.responsive.min.js"></script>


<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.9/css/jquery.dataTables.min.css">
<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/responsive/1.0.7/css/responsive.dataTables.min.css">

<script>

    var url_string = window.location.href
    var url = new URL(url_string);
    var mabid = url.searchParams.get("name_choice");
    var cat = url.searchParams.get("category_choice");
    var target = url.searchParams.get("target_choice");
    var ordering = url.searchParams.get("ordering");
    if (mabid==null){
        var mabid = ''
    }


    if (cat==null){
        var cat = ''
    }

    if (target==null){
        var target = ''
    }

    if (ordering==null){
        var ordering = ''
    }


      $(document).ready(function() {
          $('#albums').DataTable({
              "searching": false,
              "sortable": false,
              "scrollX": true,
              'serverSide': true,
              'ajax': '/api/entry_list/?format=datatables' + '&mabid=' + mabid + '&category=' + cat + '&protein_target=' + target + '&ordering=' + ordering,
              'columns': [
                  {'data': 'mabid', 'sortable': false},
                  {'data': 'get_category', 'sortable': false},
                  {'data': 'get_protein_target', 'sortable': false},
                  {'data': 'light_count', 'sortable': false},
                  {'data': 'heavy_count', 'sortable': false},
                  {'data': 'get_url', 'sortable': false, render: function ( data, type, row ) {
                        return '<a class="btn btn-info btn-sm" href=/' + data + '>' + 'Show Full Entry' + '</a>';
                   }},
              ]

          });
      });
</script>



  <div class="w3-container w3-content w3-center w3-padding-32" style="max-width:10000px">
    <div class="well" style="background-color:EAEAEA;padding:10;border-radius:8px;">
      <form method="get">

      <h3 style="margin-top: 0">Entry Filter</h3>
      <div class="row"  >

        <div class="form-group col-sm-4 col-md-3">
            <strong>mAb ID choice:</strong>
          {% render_field filter.form.name_choice class="form-control" %}
        </div>
        <div class="form-group col-sm-4 col-md-3">
            <strong>Category choice:</strong>
          {% render_field filter.form.category_choice class="form-control" %}
        </div>
        <div class="form-group col-sm-4 col-md-3">
            <strong>Target choice:</strong>
          {% render_field filter.form.target_choice class="form-control" %}
        </div>
        <div class="form-group col-sm-4 col-md-3">
            <strong>Ordering:</strong>
          {% render_field filter.form.ordering class="form-control" %}
        </div>
      </div>

        <button type="submit" class="btn btn-primary">
            <span class="glyphicon glyphicon-search"></span> Search
        </button>


      </form>
          <a href="/new_query">
               <button  label="Sequence Database" name="so_link"  class="btn btn-secondary">Reset Filter</button>
          </a>
      </div>

</div>


  <div class="w3-container w3-content w3-center w3-padding-5" style="max-width:10000px">



  <h2>Entry Results</h2>
        <table align="left" id="albums" class="table table-striped table-bordered" style="width:100%" data-server-side="true">
          <thead>
            <tr align="left">
              <th align="left" >MabID</th>
              <th align="left" >Category</th>
              <th align="left" >Protein Target</th>
              <th align="left" >Light Count</th>
              <th align="left" >Heavy Count</th>
              <th align="left" >See Entry</th>
            </tr>
          </thead>
        </table>
</div>


{% endblock %}